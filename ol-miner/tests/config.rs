//! Functional test for delay module

#![forbid(unsafe_code)]
use ol_miner::config::*;

#[test]
fn test_genesis_preimage() {
    // Create fixtures.
    let configs = OlMinerConfig {
        profile: Profile {
            public_key: "5ffd9856978b5020be7f72339e41a401".to_owned(),
            statement: "protests rage across America".to_owned(),
        },
        chain_info: ChainInfo {
            chain_id: "Ol testnet".to_owned(),
            block_dir: "blocks".to_owned(),
            base_waypoint: "None".to_owned(),
            node: None,
        },
    };

    let first_preimage = OlMinerConfig::genesis_preimage(&configs);

    println!("proof:\n{:?}", hex::encode(&first_preimage));

    let correct_preimage = "5ffd9856978b5020be7f72339e41a4010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004f6c20746573746e6574009f24000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070726f74657374732072616765206163726f737320416d6572696361";

    assert_eq!(hex::encode(&first_preimage), correct_preimage, "not true")
}
