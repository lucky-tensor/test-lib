//! Functional test for delay module

#![forbid(unsafe_code)]
use ol_miner::config::*;

#[test]
fn test_genesis_preimage() {
    // Create mocks.
    let configs = OlMinerConfig {
        profile: Profile {
            public_key: "3e4629ba1e63114b59a161e89ad4a083b3a31b5fd59e39757c493e96398e4df2"
                .to_owned(),
            statement: "protests rage across America".to_owned(),
        },
        chain_info: ChainInfo {
            chain_id: "Ol testnet".to_owned(),
            block_dir: "blocks".to_owned(),
        },
    };

    let first_preimage = OlMinerConfig::genesis_preimage(&configs);

    println!("proof:\n{:?}", hex::encode(&first_preimage));

    let correct_preimage = "3e4629ba1e63114b59a161e89ad4a083b3a31b5fd59e39757c493e96398e4df20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004f6c20746573746e6574009f24000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070726f74657374732072616765206163726f737320416d6572696361";

    assert_eq!(hex::encode(&first_preimage), correct_preimage, "not true")
}
