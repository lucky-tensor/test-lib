import 0x1.DiemAccount;
import 0x1.Coin1;
import 0x1.Diem;
import 0x1.Signer;

main(sender: &signer) {
  let sender_addr: address;
  let cap: DiemAccount.WithdrawCapability;

  sender_addr = Signer.address_of(copy(sender));

  // by default, an account has not delegated its withdrawal capability
  assert(!DiemAccount.delegated_withdraw_capability(copy(sender_addr)), 50);

  // make sure we report that the capability has been extracted
  cap = DiemAccount.extract_withdraw_capability(copy(sender));
  assert(DiemAccount.delegated_withdraw_capability(copy(sender_addr)), 51);

  // and the sender should be able to withdraw with this cap
  DiemAccount.pay_from<Coin1.Coin1>(&cap, copy(sender_addr), 100, h"", h"");

  // restoring the capability should flip the flag back
  DiemAccount.restore_withdraw_capability(move(cap));
  assert(!DiemAccount.delegated_withdraw_capability(copy(sender_addr)), 52);

  return;
}
